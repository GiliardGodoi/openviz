<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- As 3 meta tags acima *devem* vir em primeiro lugar dentro do `head`; qualquer outro conteúdo deve vir *após* essas tags -->
    <title>Bootstrap Template</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <script src="js/d3/d3.js"></script>
    <script type="text/javascript">
        function draw(received){
            let data;
            if('data' in received){
                data = received.data[1].sinopse;
            }
            debugger;
            var svg = d3.select("#container-chart"),
                margin = {top: 30, right: 20, bottom: 30, left: 40},
                width = +svg.attr("width") - margin.left - margin.right,
                height = +svg.attr("height") - margin.top - margin.bottom;

            var range_color = ['#1abc9c', '#2ecc71','#3498db', '#9b59b6', '#f39c12', '#d35400', '#d35400'];
            
            var group_chart = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            var x = d3.scaleBand().rangeRound([0, width]).padding(0.1),
                y = d3.scaleLinear().rangeRound([height, 0]),
                z = d3.scaleOrdinal().range(range_color);
            
            x.domain(data.map( d => d.dsModalidadeLicitacao));
            y.domain([0, d3.max(data, function(d) { return d.nrQuantidadeProcedimento; })]);
            z.domain([0, d3.max(data, d => d.nrQuantidadeProcedimento)]);

            group_chart.append("g")
                    .attr("class", "axis axis--x")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x));
            group_chart.append("g")
                .attr("class", "axis axis--y")
                .call(d3.axisLeft(y).ticks(10))
            const move = d3.transition().duration(750)

            var bars = group_chart.selectAll(".bar").data(data)
                    
            bars.exit().transition().duration(300).remove()

            bars.enter()
                .append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.dsModalidadeLicitacao) )
                .attr("width", x.bandwidth())
                .attr("y", function(d) { return y(d.nrQuantidadeProcedimento); })
                .attr("height", function(d) { return 0 })
                .attr("fill", d => z(d.nrQuantidadeProcedimento) )
                .transition()           // apply a transition
                .duration(4000)
                .delay(1500)         // apply it over 4000 milliseconds
                .attr("height", function(d) { return height - y(d.nrQuantidadeProcedimento); });
        }
    </script>
    <style>
        
    </style>
  </head>
  <body>
    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <a href="#" class="navbar-brand">Open Viz</a>
            </div>
            <ul class="nav navbar-nav">
                <li class="active"> <a href="#">Home</a> </li>
                <li> <a href="#">Page1</a> </li>
                <li> <a href="#">Page2</a> </li>
                <li> <a href="#">Page3</a> </li>
            </ul>
        </div>
    </nav>
    <div>
        <svg id="container-chart" width="960" height="500"></svg>
    </div>

    <script type="text/javascript">
        d3.json("/sinopses/licitacoes/412410/2016",draw);
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
  </body>
</html>